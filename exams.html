<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Exams</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="main" style="margin-left:0; max-width:800px; margin:auto">
        <a href="index.html">‚Üê Back to Subjects</a>
        <h1>Subject Exams</h1>
        
        <div class="card">
            <h3>Create Exam</h3>
            <input type="text" id="exTitle" placeholder="Exam Title">
            <input type="number" id="exDur" placeholder="Duration (minutes)">
            <button onclick="saveExam()">Save Exam</button>
        </div>

        <div id="examList"></div>
    </div>

    <script>
        const SB_URL = "YOUR_SUPABASE_URL";
        const SB_KEY = "YOUR_SUPABASE_ANON_KEY";
        const supabase = supabase.createClient(SB_URL, SB_KEY);
        const subjectId = new URLSearchParams(window.location.search).get('subjectId');

        async function saveExam() {
            await supabase.from('exams').insert({
                subject_id: subjectId,
                title: document.getElementById('exTitle').value,
                duration: document.getElementById('exDur').value,
                is_locked: true,
                questions: []
            });
            location.reload();
        }

        async function loadExams() {
            const { data } = await supabase.from('exams').select('*').eq('subject_id', subjectId);
            document.getElementById('examList').innerHTML = data.map(ex => `
                <div class="card item-row">
                    <div>
                        <strong>${ex.title}</strong> (${ex.duration} mins)
                        <span class="tag">${ex.is_locked ? 'Locked' : 'Published'}</span>
                    </div>
                    <button onclick="toggleLock('${ex.id}', ${ex.is_locked})">
                        ${ex.is_locked ? 'Unlock' : 'Lock'}
                    </button>
                </div>
            `).join('');
        }
        
        async function toggleLock(id, current) {
            await supabase.from('exams').update({ is_locked: !current }).eq('id', id);
            location.reload();
        }

        loadExams();
    </script>
</body>
</html>
